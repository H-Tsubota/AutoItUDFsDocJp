<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>Function _GUIImageList_BeginDrag</title>
  <meta http-equiv="Content-Type" content="text/html; charset=shift-jis">
  <link href="../css/default.css" rel="stylesheet" type="text/css">
</head>

<body>
<h1>Function Reference</h1>
<font size="+1">_GUIImageList_BeginDrag</font>
<hr size="2">
<p>画像のドラッグを開始します。<br></p>

<p class="codeheader">
#Include &lt;GuiImageList.au3&gt;<br>
_GUIImageList_BeginDrag($hWnd, $iTrack, $iXHotSpot, $iYHotSpot)<br>
</p>
<p>&nbsp;</p>

<p><b>パラメータ</b></p>
<table border="1" width="100%" cellspacing="0" cellpadding="3" bordercolor="#C0C0C0">
  <tr>
    <td width="15%">$hWnd</td>
    <td width="85%">コントロールのハンドル</td>
  </tr>
  <tr>
   <td>$iTrack</td>
   <td>ドラッグする画像のインデックス</td>
  </tr>
  <tr>
   <td>$iXHotSpot</td>
   <td>画像左上隅に対する相対座標でのドラッグ位置のX座標</td>
  </tr>
  <tr>
   <td>$iYHotSpot</td>
   <td>画像左上隅に対する相対座標でのドラッグ位置のY座標</td>
  </tr>
</table>

<p>&nbsp;</p>

<p><b>返し値</b></p>
<table width="100%">
  <tr>
    <td width="10%" valign="top">成功:</td>
    <td width="90%">True</td>
  </tr>
  <tr>
    <td valign="top">失敗:</td>
    <td>False</td>
  </tr>
</table>
<p>&nbsp;</p>

<p><b>注意</b></p>
この関数はドラッグに使用される一時イメージリストを作成します。<br>
後のWM_MOUSEMOVEメッセージに対する処理でImageList_DragMove関数を使用してドラッグ画像を移動させることができます。<br>
ドラッグ操作を終了するにはImageList_EndDrag関数を使用します。<br>
<br>
<p>&nbsp;</p>

<p><b>関連</b></p>
<a href="_GUIImageList_EndDrag.htm">_GUIImageList_EndDrag</a>, <a href="_GUIImageList_DragEnter.htm">_GUIImageList_DragEnter</a>
<p>&nbsp;</p>

<p><b>例</b></p>
<p class="codebox">
<br>
<span><span class="S12">#AutoIt3Wrapper_au3check_parameters=-q -d -w 1 -w 2 -w 3 -w- 4 -w 5 -w 6 -w 7</span><br>
<span class="S4">Opt</span><span class="S8">(</span><span class="S7">"MustDeclareVars"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br>
<br>
<span class="S11">#include</span><span class="S0"> </span><span class="S7">&lt;GuiConstantsEx.au3&gt;</span><br>
<span class="S11">#include</span><span class="S0"> </span><span class="S7">&lt;GuiListView.au3&gt;</span><br>
<span class="S11">#include</span><span class="S0"> </span><span class="S7">&lt;GuiImageList.au3&gt;</span><br>
<span class="S11">#include</span><span class="S0"> </span><span class="S7">&lt;Constants.au3&gt;</span><br>
<span class="S11">#include</span><span class="S0"> </span><span class="S7">&lt;WindowsConstants.au3&gt;</span><br>
<br>
<span class="S12">#region Globals *************************************************************************</span><br>
<span class="S5">Global</span><span class="S0"> </span><span class="S9">$hDragImageList</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$bDragging</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S5">False</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LV_Height</span><br>
<span class="S5">Global</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">2</span><span class="S8">]</span><span class="S0"> </span><span class="S1">; 開始位置、終了位置</span><br>
<br>
<span class="S5">Global</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><br>
<br>
<span class="S12">#endregion Globals *************************************************************************</span><br>
<br>
<span class="S4">Opt</span><span class="S8">(</span><span class="S7">"WinTitleMatchMode"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">2</span><span class="S8">)</span><br>
<br>
<span class="S0">_Main</span><span class="S8">()</span><br>
<br>
<span class="S5">Func</span><span class="S0"> _Main</span><span class="S8">()</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$image_width</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">20</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S5">Const</span><span class="S0"> </span><span class="S9">$image_height</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">20</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$himages</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$main_GUI</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$iIndex</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$main_GUI</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">GUICreate</span><span class="S8">(</span><span class="S7">"GuiImageList Begin Drag"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">225</span><span class="S8">,</span><span class="S0"> </span><span class="S3">400</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$hListView</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S15">_GUICtrlListView_Create</span><span class="S8">(</span><span class="S9">$main_GUI</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Entry Name|Category"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">5</span><span class="S8">,</span><span class="S0"> </span><span class="S3">75</span><span class="S8">,</span><span class="S0"> </span><span class="S3">220</span><span class="S8">,</span><span class="S0"> </span><span class="S3">180</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S4">BitOR</span><span class="S8">(</span><span class="S9">$WS_EX_CLIENTEDGE</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$WS_EX_STATICEDGE</span><span class="S8">))</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$LV_Height</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">180</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetColumnWidth</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">100</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetColumnWidth</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S3">100</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetExtendedListViewStyle</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S4">BitOR</span><span class="S8">(</span><span class="S9">$LVS_EX_GRIDLINES</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVS_EX_FULLROWSELECT</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVS_EX_CHECKBOXES</span><span class="S8">))</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; サブアイテム画像を使用</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetExtendedListViewStyle</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S4">BitOR</span><span class="S8">(</span><span class="S9">$LVM_SETEXTENDEDLISTVIEWSTYLE</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVS_EX_SUBITEMIMAGES</span><span class="S8">))</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; イメージリストを作成</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$himages</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S15">_GUIImageList_Create</span><span class="S8">(</span><span class="S9">$image_width</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$image_height</span><span class="S8">,</span><span class="S0"> </span><span class="S3">5</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">21</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUIImageList_AddIcon</span><span class="S8">(</span><span class="S9">$himages</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@SystemDir</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">"\shell32.dll"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$x</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Next</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetImageList</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$himages</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVSIL_SMALL</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; イベント関数を登録</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUIRegisterMsg</span><span class="S8">(</span><span class="S9">$WM_NOTIFY</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"WM_NOTIFY"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUIRegisterMsg</span><span class="S8">(</span><span class="S9">$WM_LBUTTONUP</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"WM_LBUTTONUP"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUIRegisterMsg</span><span class="S8">(</span><span class="S9">$WM_MOUSEMOVE</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"WM_MOUSEMOVE"</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 画像つきリストビューアイテムを追加</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S3">9</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$iIndex</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S15">_GUICtrlListView_AddItem</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Name "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">+</span><span class="S0"> </span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">)</span><span class="S0"> </span><span class="S1">; ハンドル、文字列、画像インデックス</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_AddSubItem</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$iIndex</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Category "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">+</span><span class="S0"> </span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">+</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S1">; ハンドル、インデックス、文字列、サブアイテム、画像インデックス</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">+=</span><span class="S0"> </span><span class="S3">2</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Next</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUISetState</span><span class="S8">()</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">While</span><span class="S0"> </span><span class="S3">1</span><br>
<br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Switch</span><span class="S0"> </span><span class="S4">GUIGetMsg</span><span class="S8">()</span><br>
<br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;-----------------------------------------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">; 必要な場合、このケースにコードを追加作成</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S9">$GUI_EVENT_CLOSE</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">ExitLoop</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;-----------------------------------------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">; その他の処理は全てここ</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S5">Else</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;;;</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndSwitch</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">WEnd</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUIImageList_Destroy</span><span class="S8">(</span><span class="S9">$himages</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">GUIDelete</span><span class="S8">()</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;_Main</span><br>
<br>
<span class="S12">#region Item Function(s) **********************************************************************************************</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S5">Func</span><span class="S0"> _LVInsertItem</span><span class="S8">(</span><span class="S9">$i_FromItem</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_ToItem</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$item_state</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_newIndex</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S9">$tagLVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$struct_String</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S7">"wchar Buffer[4096]"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$sBuffer_pointer</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetPtr</span><span class="S8">(</span><span class="S9">$struct_String</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; アイテムを新しい位置に挿入</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S4">BitOR</span><span class="S8">(</span><span class="S9">$LVIF_STATE</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_IMAGE</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_INDENT</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_PARAM</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_TEXT</span><span class="S8">))</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"StateMask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIS_STATEIMAGEMASK</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Item"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_FromItem</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"SubItem"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"TextMax"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">4096</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Text"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$sBuffer_pointer</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_GetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$item_state</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"State"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Item"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_ToItem</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$i_newIndex</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S15">_GUICtrlListView_InsertItem</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$struct_String</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Buffer"</span><span class="S8">),</span><span class="S0"> </span><span class="S9">$i_ToItem</span><span class="S8">,</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Image"</span><span class="S8">))</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 以前の状態を復元</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$i_newIndex = "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$i_newIndex</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_STATE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Item"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_newIndex</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"State"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$item_state</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"StateMask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIS_STATEIMAGEMASK</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemState</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_newIndex</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$item_state</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIS_STATEIMAGEMASK</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$i_newIndex</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;_LVInsertItem</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S5">Func</span><span class="S0"> _LVCopyItem</span><span class="S8">(</span><span class="S9">$i_FromItem</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_ToItem</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_SubItem</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S9">$tagLVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$struct_String</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S7">"wchar Buffer[4096]"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$sBuffer_pointer</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetPtr</span><span class="S8">(</span><span class="S9">$struct_String</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; アイテム情報から取得</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S4">BitOR</span><span class="S8">(</span><span class="S9">$LVIF_STATE</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_IMAGE</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_INDENT</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_PARAM</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_TEXT</span><span class="S8">))</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"StateMask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIS_STATEIMAGEMASK</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Item"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_FromItem</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"SubItem"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_SubItem</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"TextMax"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">4096</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Text"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$sBuffer_pointer</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_GetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Item"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_ToItem</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; テキストを設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_TEXT</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Text"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$sBuffer_pointer</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"TextMax"</span><span class="S8">,</span><span class="S0"> </span><span class="S3">4096</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(</span><span class="S6">@error</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@error</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@error</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; ステータスを設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_STATE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 画像を設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_IMAGE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"State"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_IMAGE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 状態を設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_STATE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"State"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_STATE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; インデントを設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_INDENT</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"State"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_INDENT</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; パラメータを設定</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Mask"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_PARAM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVITEM</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"State"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVIF_PARAM</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_SetItemEx</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$struct_LVITEM</span><span class="S8">)</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;_LVCopyItem</span><br>
<span class="S12">#endregion Item Function(s) **********************************************************************************************</span><br>
<br>
<span class="S12">#region Event Function(s) **********************************************************************************************</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">; WM_MOUSEMOVEイベントハンドラ</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S5">Func</span><span class="S0"> WM_MOUSEMOVE</span><span class="S8">(</span><span class="S9">$hWndGUI</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$MsgID</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$wParam</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$lParam</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S12">#forceref $MsgID, $wParam</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; ここではドラッグされていないアイテムを処理</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$bDragging</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S5">False</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 画像移動を更新</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$lpos</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">ControlGetPos</span><span class="S8">(</span><span class="S9">$hWndGUI</span><span class="S8">,</span><span class="S0"> </span><span class="S7">""</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$hListView</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$lParam</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0xFFFF</span><span class="S8">)</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S9">$lpos</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">BitShift</span><span class="S8">(</span><span class="S9">$lParam</span><span class="S8">,</span><span class="S0"> </span><span class="S3">16</span><span class="S8">)</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S9">$lpos</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">&gt;</span><span class="S0"> </span><span class="S9">$LV_Height</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S3">20</span><span class="S0"> </span><span class="S5">Then</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_Scroll</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">ElseIf</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">&lt;</span><span class="S0"> </span><span class="S3">20</span><span class="S0"> </span><span class="S5">Then</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_Scroll</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">*</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUIImageList_DragMove</span><span class="S8">(</span><span class="S9">$x</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;WM_MOUSEMOVE</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">; WM_LBUTTONUPイベントハンドラ</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S5">Func</span><span class="S0"> WM_LBUTTONUP</span><span class="S8">(</span><span class="S9">$hWndGUI</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$MsgID</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$wParam</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$lParam</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S12">#forceref $MsgID, $wParam</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$bDragging</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S5">False</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$lpos</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">ControlGetPos</span><span class="S8">(</span><span class="S9">$hWndGUI</span><span class="S8">,</span><span class="S0"> </span><span class="S7">""</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$hListView</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$lParam</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0xFFFF</span><span class="S8">)</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S9">$lpos</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">BitShift</span><span class="S8">(</span><span class="S9">$lParam</span><span class="S8">,</span><span class="S0"> </span><span class="S3">16</span><span class="S8">)</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S9">$lpos</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$x = "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$x</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$y = "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; ドラッグ処理</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUIImageList_DragLeave</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUIImageList_EndDrag</span><span class="S8">()</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_GUIImageList_Destroy</span><span class="S8">(</span><span class="S9">$hDragImageList</span><span class="S8">[</span><span class="S3">0</span><span class="S8">])</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S15">_WinAPI_ReleaseCapture</span><span class="S8">()</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; リストビューでドラッグが有効になっているか確認するためのヒットテストをおこなう</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$struct_LVHITTESTINFO</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S9">$tagLVHITTESTINFO</span><span class="S8">)</span><br>
<br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVHITTESTINFO</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"X"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$x</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$struct_LVHITTESTINFO</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Y"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S15">_SendMessage</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVM_HITTEST</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S4">DllStructGetPtr</span><span class="S8">(</span><span class="S9">$struct_LVHITTESTINFO</span><span class="S8">),</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"wparam"</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"ptr"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$flags</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$struct_LVHITTESTINFO</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Flags"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$flags: "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$flags</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;~ &nbsp;// リストビューの外?</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><span class="S0"> </span><span class="S8">==</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;~ &nbsp;// アイテム内でない?</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$flags</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVHT_ONITEMLABEL</span><span class="S8">)</span><span class="S0"> </span><span class="S8">==</span><span class="S0"> </span><span class="S3">0</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$flags</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVHT_ONITEMSTATEICON</span><span class="S8">)</span><span class="S0"> </span><span class="S8">==</span><span class="S0"> </span><span class="S3">0</span><span class="S0"> </span><span class="S5">And</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$flags</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$LVHT_ONITEMICON</span><span class="S8">)</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">0</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">; 挿入が少なくとも2アイテム上または下であることを確認。2重作成は不可</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><span class="S0"> </span><span class="S8">&lt;</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">Or</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><span class="S0"> </span><span class="S8">&gt;</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><span class="S0"> </span><span class="S8">+</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">Then</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"To = "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">])</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$i_newIndex</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> _LVInsertItem</span><span class="S8">(</span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">],</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">])</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$From_index</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><span class="S0"> </span><span class="S8">&gt;</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">1</span><span class="S8">]</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S9">$From_index</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><span class="S0"> </span><span class="S8">+</span><span class="S0"> </span><span class="S3">1</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">; アイテム、サブアイテム画像、テキスト、状態をコピー</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">For</span><span class="S0"> </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">To</span><span class="S0"> </span><span class="S15">_GUICtrlListView_GetColumnCount</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">)</span><span class="S0"> </span><span class="S8">-</span><span class="S0"> </span><span class="S3">1</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _LVCopyItem</span><span class="S8">(</span><span class="S9">$From_index</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$i_newIndex</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$x</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Next</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">; 削除</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUICtrlListView_DeleteItem</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$From_index</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndIf</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;WM_LBUTTONUP</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">; WM_NOTIFYイベントハンドラ</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S1">;------------------------------------------------------</span><br>
<span class="S5">Func</span><span class="S0"> WM_NOTIFY</span><span class="S8">(</span><span class="S9">$hWndGUI</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$MsgID</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$wParam</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$lParam</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S12">#forceref $hWndGUI, $MsgID, $wParam</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Local</span><span class="S0"> </span><span class="S9">$tNMHDR</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$code</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$x</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$tNMLISTVIEW</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$hwndFrom</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$tDraw</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$dwDrawStage</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$dwItemSpec</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$tNMHDR</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S9">$tagNMHDR</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$lParam</span><span class="S8">)</span><span class="S0"> </span><span class="S1">;NMHDR (hwndFrom, idFrom, code)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$code</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$tNMHDR</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Code"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$hwndFrom</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$tNMHDR</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"hWndFrom"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Switch</span><span class="S0"> </span><span class="S9">$hwndFrom</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S9">$hListView</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Switch</span><span class="S0"> </span><span class="S9">$code</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S9">$LVN_BEGINDRAG</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$LVN_BEGINDRAG"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$x</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$lParam</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0xFFFF</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$y</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">BitShift</span><span class="S8">(</span><span class="S9">$lParam</span><span class="S8">,</span><span class="S0"> </span><span class="S3">16</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$tNMLISTVIEW</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S9">$tagNMLISTVIEW</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$lParam</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">]</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$tNMLISTVIEW</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"Item"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$hDragImageList</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S15">_GUICtrlListView_CreateDragImage</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">])</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUIImageList_BeginDrag</span><span class="S8">(</span><span class="S9">$hDragImageList</span><span class="S8">[</span><span class="S3">0</span><span class="S8">],</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">,</span><span class="S0"> </span><span class="S3">0</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S1">;------------------------------------------------------</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S6">@error</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> </span><span class="S5">Return</span><span class="S0"> </span><span class="S4">SetError</span><span class="S8">(-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S8">-</span><span class="S3">1</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"From = "</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$a_index</span><span class="S8">[</span><span class="S3">0</span><span class="S8">])</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_GUIImageList_DragEnter</span><span class="S8">(</span><span class="S9">$hListView</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$x</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$y</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S15">_WinAPI_SetCapture</span><span class="S8">(</span><span class="S9">$hWndGUI</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$bDragging</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S5">True</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S9">$NM_CUSTOMDRAW</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$NM_CUSTOMDRAW"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$tDraw</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructCreate</span><span class="S8">(</span><span class="S9">$tagNMLVCUSTOMDRAW</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$lParam</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$dwDrawStage</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$tDraw</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"dwDrawStage"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S9">$dwItemSpec</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">DllStructGetData</span><span class="S8">(</span><span class="S9">$tDraw</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"dwItemSpec"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Switch</span><span class="S0"> </span><span class="S9">$dwDrawStage</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S9">$CDDS_PREPAINT</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$CDDS_PREPAINT"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$CDRF_NOTIFYITEMDRAW</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Case</span><span class="S0"> </span><span class="S9">$CDDS_ITEMPREPAINT</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S9">$DebugIt</span><span class="S0"> </span><span class="S5">Then</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S7">"$CDDS_ITEMPREPAINT"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">If</span><span class="S0"> </span><span class="S4">BitAND</span><span class="S8">(</span><span class="S9">$dwItemSpec</span><span class="S8">,</span><span class="S0"> </span><span class="S3">1</span><span class="S8">)</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S3">1</span><span class="S0"> </span><span class="S5">Then</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$tDraw</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"clrTextBk"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$CLR_AQUA</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Else</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S4">DllStructSetData</span><span class="S8">(</span><span class="S9">$tDraw</span><span class="S8">,</span><span class="S0"> </span><span class="S7">"clrTextBk"</span><span class="S8">,</span><span class="S0"> </span><span class="S9">$CLR_WHITE</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndIf</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$CDRF_NEWFONT</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndSwitch</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S5">EndSwitch</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">EndSwitch</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S5">Return</span><span class="S0"> </span><span class="S9">$GUI_RUNDEFMSG</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;WM_NOTIFY</span><br>
<span class="S12">#endregion Event Function(s) **********************************************************************************************</span><br>
<br>
<span class="S5">Func</span><span class="S0"> _DebugPrint</span><span class="S8">(</span><span class="S9">$s_text</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S9">$s_text</span><span class="S0"> </span><span class="S8">=</span><span class="S0"> </span><span class="S4">StringReplace</span><span class="S8">(</span><span class="S9">$s_text</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@LF</span><span class="S8">,</span><span class="S0"> </span><span class="S6">@LF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S7">"--&gt;"</span><span class="S8">)</span><br>
<span class="S0">&nbsp; &nbsp; </span><span class="S4">ConsoleWrite</span><span class="S8">(</span><span class="S7">"!==========================================================="</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@LF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S8">_</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S7">"+==========================================================="</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@LF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S8">_</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S7">"--&gt;"</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S9">$s_text</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@LF</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S8">_</span><br>
<span class="S0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="S7">"+==========================================================="</span><span class="S0"> </span><span class="S8">&amp;</span><span class="S0"> </span><span class="S6">@LF</span><span class="S8">)</span><br>
<span class="S5">EndFunc</span><span class="S0"> &nbsp;&nbsp;</span><span class="S1">;==&gt;_DebugPrint</span><br>
<span class="S0"></span></span><br>
<script type="text/javascript">
if (document.URL.match(/^mk:@MSITStore:/i))
document.write('<br><OBJECT id=hhctrl type="application/x-oleobject" classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=58 height=57><PARAM name="Command" value="ShortCut"><PARAM name="Button" value="Text:Open this Script"><PARAM name="Item1" value=",Examples\\HelpFile\\_GUIImageList_BeginDrag.au3,"></OBJECT>');
</script>
<p>&nbsp;</p>

</body>
</html>
